–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∫–∞–∫ —É SRE Google

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ Dockerfile. –≠—Ç–æ –º–∏–∫—Ä–æ—Å–∏—Å—Ç–µ–º–∞, –∏ –µ—Å–ª–∏ –µ—ë –Ω–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å ‚Äî –æ–Ω–∞ –±—É–¥–µ—Ç –∂–µ—á—å CPU, RAM –∏ SSD –±–µ–∑ –ø–æ–ª—å–∑—ã. –í–æ—Ç  üî• –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Å–æ–≤–µ—Ç—ã –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:

‚ö´Ô∏è  –û–≥—Ä–∞–Ω–∏—á—å –ø—Ä–∞–≤–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

docker run --read-only --cap-drop=ALL --security-opt no-new-privileges ...

‚ñ™Ô∏è --read-only ‚Äî –∑–∞—â–∏—â–∞–µ—Ç —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É  
‚ñ™Ô∏è --cap-drop=ALL ‚Äî —É–¥–∞–ª—è–µ—Ç –ª–∏—à–Ω–∏–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏  
‚ñ™Ô∏è no-new-privileges ‚Äî –∑–∞–ø—Ä–µ—â–∞–µ—Ç –ø–æ–≤—ã—à–µ–Ω–∏–µ –ø—Ä–∞–≤ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ

‚ö´Ô∏è  –£—Å—Ç–∞–Ω–æ–≤–∏ –ª–∏–º–∏—Ç—ã CPU –∏ –ø–∞–º—è—Ç–∏

docker run --memory="512m" --cpus="1.5" ...

‚ñ™Ô∏è –ù–µ –¥–∞–≤–∞–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É –∂—Ä–∞—Ç—å –≤–µ—Å—å —Ö–æ—Å—Ç ‚Äî –æ—Å–æ–±–µ–Ω–Ω–æ –Ω–∞ multi-tenant –Ω–æ–¥–∞—Ö  
‚ñ™Ô∏è –ò—Å–ø–æ–ª—å–∑—É–π cpu-shares, cpuset, ulimits –¥–ª—è —Ç–æ–Ω–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

‚ö´Ô∏è  –ß–∏—Å—Ç–∏ –æ—Ç –º—É—Å–æ—Ä–∞
- –ò—Å–ø–æ–ª—å–∑—É–π multi-stage builds ‚Äî –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–π —Ä–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞  
- –û—Å—Ç–∞–≤–ª—è–π —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –±–∏–Ω–∞—Ä–Ω–∏–∫–∏ –∏ –∫–æ–Ω—Ñ–∏–≥–∏  
- –ü—Ä–∏–º–µ—Ä:

FROM golang:1.22 as builder
WORKDIR /app
COPY . .
RUN go build -o app

FROM alpine:3.19
COPY --from=builder /app/app /bin/app
ENTRYPOINT ["/bin/app"]


‚ö´Ô∏è  –ò—Å–ø–æ–ª—å–∑—É–π distroless –∏–ª–∏ Alpine
- –û–±—Ä–∞–∑—ã —Ç–∏–ø–∞ gcr.io/distroless/static ‚Äî –±–µ–∑ —à–µ–ª–ª–∞, package manager –∏ –º—É—Å–æ—Ä–∞  
- alpine ‚Äî –ª–µ–≥—á–µ, –Ω–æ —Å–ª–µ–¥–∏ –∑–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å—é —Å glibc

‚ö´Ô∏è  –ü—Ä–æ–ø–∏—à–∏ healthcheck

HEALTHCHECK --interval=30s --timeout=3s CMD curl -f http://localhost:8080/health || exit 1

‚ñ™Ô∏è Kubernetes –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–±–æ—è—Ö

‚ö´Ô∏è –ü–æ–¥–∫–ª—é—á–∏ observability
- –í—Å—Ç—Ä–∞–∏–≤–∞–π Prometheus exporter  
- –õ–æ–≥–∏ ‚Äî –≤ stdout/stderr (–¥–ª—è kubectl logs –∏ EFK/PLG —Å—Ç–µ–∫–∞)  
- –ò—Å–ø–æ–ª—å–∑—É–π otel, –µ—Å–ª–∏ –Ω—É–∂–µ–Ω tracing

‚ö´Ô∏è  –ü—Ä–æ–≤–µ—Ä—å, —á–µ–º –∑–∞–Ω—è—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

docker top <container>
docker inspect --format '{{ .HostConfig }}' <container>

‚ñ™Ô∏è –í–æ–≤—Ä–µ–º—è –∑–∞–º–µ—Ç–∏—à—å, –µ—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å —Ñ–æ—Ä–∫–∞–µ—Ç —á—Ç–æ-—Ç–æ –ª–∏—à–Ω–µ–µ –∏–ª–∏ –∏–¥—ë—Ç —á–µ—Ä–µ–∑ /dev

üí° –≠—Ç–∏ –ø—Ä–∞–∫—Ç–∏–∫–∏ –∫—Ä–∏—Ç–∏—á–Ω—ã, –µ—Å–ª–∏:
- –í—ã –¥–µ–ø–ª–æ–∏—Ç–µ –≤ –ø—Ä–æ–¥ —Å autoscaling  
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∫—Ä—É—Ç—è—Ç—Å—è –≤ k8s –∏–ª–∏ Fargate  
- –í–∞–º –≤–∞–∂–Ω–æ —Å–æ–∫—Ä–∞—Ç–∏—Ç—å –∏–∑–¥–µ—Ä–∂–∫–∏ –Ω–∞ —Ä–µ—Å—É—Ä—Å—ã –∏ –ø–æ–≤—ã—Å–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å