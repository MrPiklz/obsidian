–í—ã –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ Docker –∏–ª–∏ systemd-nspawn) –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç–µ –ª–∏–º–∏—Ç –ø–æ –ø–∞–º—è—Ç–∏ —Å –ø–æ–º–æ—â—å—é cgroup v2:


echo 500M > /sys/fs/cgroup/myservice/memory.max

–°–µ—Ä–≤–∏—Å —Å—Ç–∞—Ä—Ç—É–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –Ω–æ —á–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è —Å–µ—Ä–≤–µ—Ä –Ω–∞—á–∏–Ω–∞–µ—Ç —Ç–æ—Ä–º–æ–∑–∏—Ç—å, –∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ —Å—É–º–º–∞—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç—ã.

–ü—Ä–∏ —ç—Ç–æ–º –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤—Å—ë –≤—ã–≥–ª—è–¥–∏—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ ‚Äî top`/`htop –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ –≤ —Ä–∞–º–∫–∞—Ö –ª–∏–º–∏—Ç–∞.

–ü–æ—á–µ–º—É —Å–µ—Ä–≤–µ—Ä ¬´—Å—ä–µ–¥–∞–µ—Ç¬ª –±–æ–ª—å—à–µ –ø–∞–º—è—Ç–∏, —á–µ–º —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ? –ö–∞–∫ —ç—Ç–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –æ–±—ä—è—Å–Ω–∏—Ç—å?

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∞–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç tmpfs (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –∫—ç—à–∞), –∏ —É –≤–∞—Å –≤–∫–ª—é—á—ë–Ω swap.

–ú–Ω–æ–≥–∏–µ –∞–¥–º–∏–Ω—ã –ø–æ–ª–∞–≥–∞—é—Ç, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ª–∏–º–∏—Ç–∞ —á–µ—Ä–µ–∑ cgroup (–æ—Å–æ–±–µ–Ω–Ω–æ memory.max –≤ cgroup v2) –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –í–°–Å –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –±—É–¥–µ—Ç –ª–∏–º–∏—Ç–∏—Ä–æ–≤–∞–Ω–æ. –ù–æ —ç—Ç–æ –Ω–µ –≤—Å–µ–≥–¥–∞ —Ç–∞–∫.


 tmpfs –∏ cgroups:

- tmpfs (–Ω–∞–ø—Ä–∏–º–µ—Ä, /dev/shm, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–∞—Ç–∞–ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞) –Ω–µ –≤—Å–µ–≥–¥–∞ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–∏ –ø–æ –ø–∞–º—è—Ç–∏ cgroup.  
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é tmpfs –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –æ–±—â–µ–π —Å–∏—Å—Ç–µ–º—ã –∏ –º–æ–∂–µ—Ç ¬´–≤—ã—Ö–æ–¥–∏—Ç—å –∑–∞ –ª–∏–º–∏—Ç¬ª, –µ—Å–ª–∏ mount options –Ω–µ –±—ã–ª–∏ –∑–∞–¥–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

 Page Cache:

- –î–∞–∂–µ –µ—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–Ω—É—Ç—Ä–∏ –ª–∏–º–∏—Ç–∞ –ø–æ –ø–∞–º—è—Ç–∏, –µ–≥–æ —Ñ–∞–π–ª–æ–≤—ã–π –≤–≤–æ–¥/–≤—ã–≤–æ–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –±–æ–ª—å—à–∏–µ –ª–æ–≥–∏) –º–æ–∂–µ—Ç –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å –∫—ç—à –≤ page cache –Ω–∞ —É—Ä–æ–≤–Ω–µ —è–¥—Ä–∞, —á—Ç–æ –Ω–µ –≤—Å–µ–≥–¥–∞ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è cgroup –∫–∞–∫ ¬´—Ä–µ–∞–ª—å–Ω–æ–µ¬ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞.


 Swap –∏ cgroup:

- –ï—Å–ª–∏ swap –≤–∫–ª—é—á—ë–Ω, –ø—Ä–æ—Ü–µ—Å—Å—ã –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –¥–∞–∂–µ –ø–æ—Å–ª–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–∏—Å—Ç–µ–º–µ ¬´–æ–±—Ö–æ–¥–∏—Ç—å¬ª —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –ª–∏–º–∏—Ç (–≤ —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏—è—Ö —è–¥—Ä–∞). –í cgroup v2 —ç—Ç–æ —Å—Ç–∞–ª–æ –ª—É—á—à–µ, –Ω–æ –≤—Å—ë –µ—â—ë –≤–æ–∑–º–æ–∂–Ω—ã –Ω—é–∞–Ω—Å—ã –ø—Ä–∏ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ swap –∏ tmpfs.



 –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

1Ô∏è‚É£ –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å, –∫—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –¥–µ—Ä–∂–∏—Ç –ø–∞–º—è—Ç—å:

```bash
cat /sys/fs/cgroup/myservice/memory.current
```

2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å tmpfs –≤–Ω—É—Ç—Ä–∏ cgroup:

```bash
findmnt -o TARGET,SIZE,USED -t tmpfs
```

3Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—â–∏–π –∫—ç—à —è–¥—Ä–∞:

```bash
free -h
```

4Ô∏è‚É£ –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ cgroup-–º–µ—Ç—Ä–∏–∫–∞–º —á–µ—Ä–µ–∑ cat /proc/<pid>/cgroup.

---

üõ† –ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:

- –ü—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ tmpfs —É–∫–∞–∑—ã–≤–∞—Ç—å –æ–ø—Ü–∏—é size –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ª–∏–º–∏—Ç–∞ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ tmpfs –≤–Ω—É—Ç—Ä–∏ cgroup, —á—Ç–æ–±—ã –æ–Ω–æ —Å—á–∏—Ç–∞–ª–æ—Å—å —á–∞—Å—Ç—å—é –ª–∏–º–∏—Ç–∞:

```bash
mount -t tmpfs -o size=100M tmpfs /mycontainer/tmp
```

- –î–ª—è Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–ª–∞–≥:

```bash
--tmpfs /tmp:size=100m
```

- –û–±–Ω–æ–≤–∏—Ç—å —è–¥—Ä–æ –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏, –≥–¥–µ cgroup v2 –ª—É—á—à–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å tmpfs –∏ swap.

---

‚úÖ –í—ã–≤–æ–¥:

‚Ä¢ cgroups –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—Ç –ø—Ä–æ—Ü–µ—Å—Å—ã, –Ω–æ –Ω–µ –≤—Å–µ–≥–¥–∞ –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã (–æ—Å–æ–±–µ–Ω–Ω–æ tmpfs –∏ page cache).  
‚Ä¢ –î–∞–∂–µ –µ—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å ¬´–≤–∏–¥–∏—Ç¬ª –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏, —Å–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç –≤—ã–π—Ç–∏ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –ª–∏–º–∏—Ç–∞ –∏–∑-–∑–∞ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ tmpfs.  
‚Ä¢ –î–ª—è —Å—Ç—Ä–æ–≥–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω—É–∂–Ω–æ —è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä—ã tmpfs –∏ —Å–ª–µ–¥–∏—Ç—å –∑–∞ page cache –ø—Ä–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–µ.

üí° –ë–æ–Ω—É—Å-–≤–æ–ø—Ä–æ—Å:  
–ö–∞–∫ –º–æ–∂–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å page cache –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏, –µ—Å–ª–∏ —É –≤–∞—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –Ω–µ—Ö–≤–∞—Ç–∫–∞ –ø–∞–º—è—Ç–∏?
–ü–æ–¥—Å–∫–∞–∑–∫–∞: echo 3 > /proc/sys/vm/drop_caches 