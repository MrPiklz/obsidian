
Допустим, у нас нет доступа к хостовым process- и network- неймспейсам, но администраторы не ограничили возможности монтирования. Тогда можно примонтировать всю файловую систему хоста к поду и получить к ней доступ на чтение и запись. Теперь можем использовать те же пути эскалации привилегий, что и раньше. Этих путей столько, что Иен Колдуотер (Ian Coldwater) и Даффи Кули (Duffie Cooley) посвятили им целое выступление на Black Hat 2019: [«Неизведанный путь: атака на Kubernetes с параметрами по умолчанию»](https://www.youtube.com/watch?v=HmoVSmTIOxM).

  

Вот несколько путей эскалации привилегий, которые можно использовать, когда у нас есть доступ к файловой системе ноды Kubernetes:

  

- **Ищем файлы `kubeconfig` в файловой системе хоста**. Если повезет, можно даже найти конфигурацию `cluster-admin` с полным доступом вообще ко всему.
- **Ищем токены во всех подах на ноде**. Возьмем что-то типа `kubectl auth can-i --list` или [access-matrix](https://github.com/corneliusweig/rakkess) и посмотрим, есть ли в подах токены, которые дадут нам больше разрешений. Ищем токены, с которыми можно получать секреты или создавать поды, деплойменты и т. д. в `kube-system` или создавать clusterrolebinding.
- **Добавляем свой SSH-ключ**. Если у нас есть сетевой доступ к SSH-соединению с нодой, добавим к ноде свой публичный ключ и подключимся к ней по SSH, чтобы получить полный интерактивный доступ.
- **Ломаем хэшированные пароли**. Взламываем хэши в `/etc/shadow` и пытаемся использовать их для доступа к другим нодам.

  

**Примеры использования**

  

[https://github.com/BishopFox/badPods/tree/main/manifests/hostpath](https://github.com/BishopFox/badPods/tree/main/manifests/hostpath)

  

**Дополнительные материалы**

  

- [Неизведанный путь: атака на Kubernetes с параметрами по умолчанию с репозиторием](https://www.youtube.com/watch?v=HmoVSmTIOxM)
- [Защита Kubernetes — KubeCon NA 2019 CTF](https://securekubernetes.com/)
- [Подробный обзор угроз для Kubernetes в реальном мире](https://research.nccgroup.com/2020/02/12/command-and-kubectl-talk-follow-up/)
- [Компрометация кластера Kubernetes с помощью разрешений RBAC (слайды)](https://www.youtube.com/watch?v=1LMo0CftVC4)