 –ü—Ä–∏–º–µ—Ä –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞ –¥–ª—è Kubernetes


apiVersion: apps/v1
kind: Deployment
metadata:
  name: app-deployment
spec:
  replicas: 3
  selector:
    matchLabels:
      app: your-app
  template:
    metadata:
      labels:
        app: your-app
    spec:
      containers:
      - name: app
        image: yourrepo/app:latest
        resources:
          limits:
            memory: "512Mi"
            cpu: "1000m"
          requests:
            memory: "256Mi"
            cpu: "500m"
        securityContext:
          readOnlyRootFilesystem: true
          allowPrivilegeEscalation: false
          runAsNonRoot: true
          capabilities:
            drop:
              - ALL
        livenessProbe:
          httpGet:
            path: /health
            port: 8080
          initialDelaySeconds: 10
          periodSeconds: 20
        readinessProbe:
          httpGet:
            path: /ready
            port: 8080
          initialDelaySeconds: 5
          periodSeconds: 10


üõ° –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤, probes ‚Äî –≤—Å—ë –≤ –±–æ–µ–≤–æ–º —à–∞–±–ª–æ–Ω–µ.

---

### üõ† –ü—Ä–∏–º–µ—Ä CI-–ø–∞–π–ø–ª–∞–π–Ω–∞ (GitLab CI)


stages:
  - build
  - test
  - push

variables:
  DOCKER_BUILDKIT: 1

build:
  stage: build
  image: docker:latest
  services:
    - docker:dind
  script:
    - docker build --target production -t yourrepo/app:$CI_COMMIT_SHA .
    - docker tag yourrepo/app:$CI_COMMIT_SHA yourrepo/app:latest

test:
  stage: test
  image: yourrepo/app:$CI_COMMIT_SHA
  script:
    - ./run_tests.sh

push:
  stage: push
  script:
    - echo "$CI_REGISTRY_PASSWORD" | docker login -u "$CI_REGISTRY_USER" --password-stdin
    - docker push yourrepo/app:$CI_COMMIT_SHA
    - docker push yourrepo/app:latest
  only:
    - main


‚ö°Ô∏è –ò—Å–ø–æ–ª—å–∑—É–µ—Ç:
- BuildKit –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —É—Å–∫–æ—Ä–µ–Ω–∏—è —Å–±–æ—Ä–∫–∏  
- multi-stage Dockerfile  
- –¢–µ—Å—Ç–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–µ—Ä–µ–¥ –ø—É—à–µ–º  
- –ü—É—à–∏—Ç —Ç–æ–ª—å–∫–æ –∏–∑ main
